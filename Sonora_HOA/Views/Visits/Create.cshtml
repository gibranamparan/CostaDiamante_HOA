@model Sonora_HOA.Models.Visits
@using Sonora_HOA.Models
@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
    Condo condo = ViewBag.condo;
    CheckInList checkInList = ViewBag.checkInList;

    ViewDataDictionary vdd = new ViewDataDictionary();
    vdd.Add("selectionMode", true);
}

<a href="@Url.Action("Details","Owners",new { id=condo.owner.Id})">
    <i class="glyphicon glyphicon-arrow-left"></i>Back to Owner's details
</a>

@Html.Partial("../Owners/Partial_infoOwner", condo.owner)

<div class="panel panel-info">
    <div class="panel-heading">
        <h2 class="panel-title">Visit Notification Form</h2>
    </div>
    <div class="panel-body">
        @using (Html.BeginForm("Create", "Visits", FormMethod.Post, new { @class = "form-horizontal" }))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(model => model.date)
            @Html.HiddenFor(model => model.condoID)
            <div class="col-md-12">
                @Html.LabelFor(model => condo.name)
                <span>@condo.name</span>
            </div>
            <div class="row">
                <div class="form-group col-md-6">
                    @Html.LabelFor(model => model.arrivalDate, htmlAttributes:
                new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.arrivalDate,
                    new
                    {
                        htmlAttributes = new
                        {
                            @class = "form-control",
                            type = "Date",
                            id = "arrivalDate",
                            name = "arrivalDate"
                        }
                    })
                        @Html.ValidationMessageFor(model => model.arrivalDate, "",
                    new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group col-md-6">
                    @Html.LabelFor(model => model.departureDate, htmlAttributes:
                new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.departureDate,
                    new
                    {
                        htmlAttributes =
                    new
                    {
                        @class = "form-control",
                        type = "Date",
                        id = "departureDate",
                        name = "departureDate"
                    }
                    })
                        @Html.ValidationMessageFor(model => model.departureDate, "",
                    new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-2">
                    <div class="col-md-2">
                        <button id="createVisit" name="createVisit"class="btn btn-success"
                               data-toggle="tooltip" data-placement="top" title="Testing"
                               onclick="ValidateDates('arrivalDate', 'departureDate');">
                            Notify Visit
                        </button>
                    </div>
                    <div id="errorMessage" class="alert alert-info col-md-10"
                         role="alert" hidden>Arrival date should be the same, or before departure date!</div>
                </div>
            </div>
        }
        @*Shows current year period checkin lists*@
        <div class="col-md-12">
            <h3>Current Check In List</h3>
            @Html.Partial("../Permissions/Partial_ShowCheckInList", checkInList, vdd)
        </div>
    </div>
</div>


@section Scripts {
    <script>
        function changeIcon(boton) {
            $(boton).toggleClass("fa-window-minimize fa-window-maximize")
        }

        //Date picker validation, and button block
        $("#arrivalDate").change(function () {
            var arrival = document.getElementById("arrivalDate").value;
            var departure = document.getElementById("departureDate").value;

            if (arrival == "" || departure == "") {
                $('#createVisit').attr('disabled', true)
                $("#errorMessage").fadeIn(500, function () {

                })
            }
            else {
                //Validates ranges
                if ((Date.parse(arrival)) > (Date.parse(departure))) {

                    if ($('#createVisit').attr('disabled', true)) {
                        $("#errorMessage").fadeIn(500, function () {

                        })
                    }
                }
                else {
                    $('#createVisit').attr('disabled', false)
                    $("#errorMessage").fadeOut(500, function () {

                    })
                }
            }
        });
        $("#departureDate").change(function () {
            var arrival = document.getElementById("arrivalDate").value;
            var departure = document.getElementById("departureDate").value;
            if (departure == "" || arrival == "") {
                $('#createVisit').attr('disabled', true)
                $("#errorMessage").fadeIn(500, function () {

                })
            }
            else {
                if ((Date.parse(arrival)) > (Date.parse(departure))) {

                    if ($('#createVisit').attr('disabled', true)) {
                        $("#errorMessage").fadeIn(500, function () {

                        })
                    }
                }
                else {
                    $('#createVisit').attr('disabled', false)
                    $("#errorMessage").fadeOut(500, function () {

                    })
                }
            }

        });
    </script>
    @Scripts.Render("~/bundles/jqueryval")
}
